<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <title>Exhibitor | 會員中心－帳戶資料</title>
    <link rel="preload" href="/back-end/css/adminlte.css" as="style" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css" crossorigin="anonymous" media="print" onload="this.media='all'" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.11.0/styles/overlayscrollbars.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"/>
    <link rel="stylesheet" href="/back-end/css/adminlte.css" />
    <style>
      .kv-line{display:flex; gap:1rem; padding:.5rem 0; border-bottom:1px solid var(--bs-border-color)}
      .kv-line .k{width:120px; color:var(--bs-secondary-color)}
      .section-title{font-weight:700}
      
    </style>
  </head>
  <body class="layout-fixed sidebar-expand-lg bg-body-tertiary">
    <div class="app-wrapper">
      <!-- Header（自動注入） -->
    <div data-include="/back-end/header.html"></div>
      

      <!-- Sidebar (你的版本) -->
     <aside class="app-sidebar bg-body-secondary" data-bs-theme="dark">
        <div class="sidebar-brand">
          <a href="#" class="brand-link">
            <img src="/back-end/img/AdminLTELogo.png" alt="AdminLTE Logo" class="brand-image opacity-75 shadow" />
            <span class="brand-text fw-light">eventra</span>
          </a>
        </div>
        <div class="sidebar-wrapper">
          <nav class="mt-2">
            <ul class="nav sidebar-menu flex-column" data-lte-toggle="treeview" role="navigation" data-accordion="false">
              <li class="nav-item"><a  class="nav-link"><p>展商後台</p></a></li>
              <li class="nav-item menu-open">
                <a href="#" class="nav-link"><i class="nav-icon bi bi-circle-fill"></i><p>展覽管理</p></a>
                <ul class="nav nav-treeview">
                  <li class="nav-item"><a href="/back-end/exhibitor/exhibition_list" class="nav-link"><p>展覽列表</p></a></li>
                
                </ul>
              </li>
              <li class="nav-item menu-open">
                <a href="#" class="nav-link"><i class="nav-icon bi bi-circle-fill"></i><p>銷售管理</p></a>
                <ul class="nav nav-treeview">
                  <li class="nav-item"><a href="/back-end/exhibitor/order_list" class="nav-link"><p>訂單列表</p></a></li>
                  <!-- <li class="nav-item"><a href="#" class="nav-link"><p>銷售列表</p></a></li> -->
                
                </ul>
              </li>
               <li class="nav-item menu-open">
                <a href="#" class="nav-link"><i class="nav-icon bi bi-circle-fill"></i><p>會員中心</p></a>
                <ul class="nav nav-treeview">
                  <li class="nav-item"><a href="/back-end/exhibitor/exhibitor_info" class="nav-link"><p>展商資訊</p></a></li>
                  <li class="nav-item"><a href="/back-end/exhibitor/exhibitor_account_data" class="nav-link"><p>帳戶資料</p></a></li>
                
                </ul>
              </li>
            </ul>
          </nav>
         <!-- 底部：登出連結 -->
          <div class="p-3 border-top">
            <a href="/back-end/exhibitor/exhibitor_login" id="logoutLink" class="nav-link text-danger">
              <i class="bi bi-box-arrow-right me-1"></i> 登出
            </a>
          </div>
        </div>
      </aside>

      <!-- Main -->
      <main class="app-main">
      <!-- 成功訊息 -->
		<div class="container-fluid" th:if="${msg}">
		  <div class="alert alert-success alert-dismissible fade show" role="alert">
		    <span th:text="${msg}">更新成功！</span>
		    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
		  </div>
		</div>
        <div class="app-content-header">
          <div class="container-fluid">
            <div class="row align-items-center">
              <div class="col-sm-8"><h3 class="mb-0">會員中心－帳戶資料</h3></div>
              <div class="col-sm-4 text-sm-end mt-2 mt-sm-0">
                <button class="btn btn-outline-secondary btn-sm" id="btnEdit"><i class="bi bi-pencil me-1"></i>編輯</button>
              </div>
            </div>
          </div>
        </div>

        <div class="app-content">
          <div class="container-fluid">
            <div class="card mb-4">
              <div class="card-body">
                <div class="kv-line"><div class="k">帳號(統編)</div>
				  <div id="vTaxId"
				       th:text="${exhibitor != null ? exhibitor.businessIdNumber : '-'}">-</div></div>
				
				<div class="kv-line"><div class="k">信箱</div>
				  <div id="vEmail" th:text="${exhibitor != null ? exhibitor.email : '-'}">-</div></div>
				
				<div class="kv-line"><div class="k">聯絡人姓名</div>
				  <div id="vContact" th:text="${exhibitor != null ? exhibitor.contactName : '-'}">-</div></div>
				
				<div class="kv-line"><div class="k">聯絡電話</div>
				  <div id="vPhone" th:text="${exhibitor != null ? exhibitor.contactPhone : '-'}">-</div></div>
				
				<div class="kv-line"><div class="k">公司/單位名稱</div>
				  <div id="vCompany" th:text="${exhibitor != null ? exhibitor.companyName : '-'}">-</div></div>
				
				<div class="kv-line" style="border:none"><div class="k">平台註冊名稱</div>
				  <div id="vDisplay"
				       th:text="${exhibitor != null ? exhibitor.exhibitorRegistrationName : '-'}">-</div></div>
              </div>
            </div>

            <div class="card">
              <div class="card-header"><span class="section-title">銀行帳戶資訊</span></div>
              <div class="card-body">
                <div class="kv-line"><div class="k">戶名</div>
				  <div id="vBankOwner" th:text="${exhibitor != null ? exhibitor.bankAccountName : '-'}">-</div></div>
				
				<div class="kv-line"><div class="k">銀行代碼</div>
				  <div id="vBankCode" th:text="${exhibitor != null ? exhibitor.bankCode : '-'}">-</div></div>
				
				<div class="kv-line" style="border:none"><div class="k">帳號</div>
				  <div id="vBankNo" th:text="${exhibitor != null ? exhibitor.bankAccountNumber : '-'}">-</div></div>
              </div>
            </div>
          </div>
        </div>
      </main>

      <footer class="app-footer">
        <!-- <div class="float-end d-none d-sm-inline">Anything you want</div>
        <strong>Copyright &copy; 2014-2025 <a href="https://adminlte.io">AdminLTE.io</a>.</strong> All rights reserved. -->
      </footer>
    </div>

    <!-- 編輯 Modal -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
	  <div class="modal-dialog modal-lg modal-dialog-centered">
	    <div class="modal-content">
	      <div class="modal-header"><h5 class="modal-title">編輯帳戶資料</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
	      <form id="accountForm"
	            th:action="@{/back-end/exhibitor/exhibitor_account_data/update}"
	            method="post" class="row g-3 needs-validation" novalidate>
	        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
	
	        <div class="modal-body">
	          <div class="col-md-6">
	            <label class="form-label">帳號(統編)</label>
	            <input type="text" class="form-control" name="businessIdNumber"
	                   pattern="^\d{8}$" maxlength="8" required
	                   th:value="${exhibitor != null ? exhibitor.businessIdNumber : ''}" />
	            <div class="invalid-feedback">請輸入 8 碼數字統一編號。</div>
	          </div>
	
	          <div class="col-md-6">
	            <label class="form-label">信箱</label>
	            <input type="email" class="form-control" name="email" maxlength="100" required
	                   th:value="${exhibitor != null ? exhibitor.email : ''}" />
	            <div class="invalid-feedback">請輸入有效 Email。</div>
	          </div>
	
	          <div class="col-md-6">
	            <label class="form-label">聯絡人姓名</label>
	            <input type="text" class="form-control" name="contactName" maxlength="100"
	                   th:value="${exhibitor != null ? exhibitor.contactName : ''}" />
	          </div>
	
	          <div class="col-md-6">
	            <label class="form-label">聯絡電話</label>
	            <input type="text" class="form-control" name="contactPhone" maxlength="50" required
	                   th:value="${exhibitor != null ? exhibitor.contactPhone : ''}" />
	            <div class="invalid-feedback">請輸入聯絡電話。</div>
	          </div>
	
	          <div class="col-md-6">
	            <label class="form-label">公司/單位名稱</label>
	            <input type="text" class="form-control" name="companyName" maxlength="255" required
	                   th:value="${exhibitor != null ? exhibitor.companyName : ''}" />
	            <div class="invalid-feedback">請填寫公司/單位名稱。</div>
	          </div>
	
	          <div class="col-md-6">
	            <label class="form-label">平台註冊名稱</label>
	            <input type="text" class="form-control" name="exhibitorRegistrationName" maxlength="100"
	                   th:value="${exhibitor != null ? exhibitor.exhibitorRegistrationName : ''}" />
	          </div>
	
	          <div class="col-12"><hr class="my-2"></div>
	
	          <div class="col-md-4">
	            <label class="form-label">戶名</label>
	            <input type="text" class="form-control" name="bankAccountName" maxlength="100" required
	                   th:value="${exhibitor != null ? exhibitor.bankAccountName : ''}" />
	            <div class="invalid-feedback">請填寫戶名。</div>
	          </div>
	
	          <div class="col-md-4">
	            <label class="form-label">銀行代碼</label>
	            <input type="text" class="form-control" name="bankCode" required pattern="^\d{3}$" maxlength="3"
	                   th:value="${exhibitor != null ? exhibitor.bankCode : ''}" />
	            <div class="invalid-feedback">請輸入 3 碼銀行代碼。</div>
	          </div>
	
	          <div class="col-md-4">
	            <label class="form-label">帳號</label>
	            <input type="text" class="form-control" name="bankAccountNumber" required pattern="^\d{7,30}$" maxlength="30"
	                   th:value="${exhibitor != null ? exhibitor.bankAccountNumber : ''}" />
	            <div class="invalid-feedback">請輸入 7–30 碼數字帳號。</div>
	          </div>
	        </div>
	
	        <div class="modal-footer">
	          <button  type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">取消</button>
	          <button  type="submit" class="btn btn-primary">儲存</button>
	        </div>
	      </form>
	    </div>
	  </div>
	</div>

	
    <script src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.11.0/browser/overlayscrollbars.browser.es6.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.min.js"></script>
    <script src="/back-end/js/adminlte.min.js"></script>
    <script src="/front-end/js/g1_10_custom_common_csrf.js"></script>
    <script>
        document.getElementById('logoutLink')?.addEventListener('click', (e) => {
          e.preventDefault();
          // 清除登入紀錄
          sessionStorage.removeItem('exhibitorSession');
          // 導回登入頁
          window.location.href = '/back-end/exhibitor/exhibitor_login';
        });
      </script>

      <script>
    (async () => {
      // 讓放了 data-include 的容器先隱藏，避免 FOUC
      document.querySelectorAll('[data-include]').forEach(el => el.style.visibility = 'hidden');

      // 載入所有 partial
      const tasks = [...document.querySelectorAll('[data-include]')].map(async (el) => {
        const url = el.getAttribute('data-include');
        const bust = `v=${encodeURIComponent((window.__PARTIALS_VERSION__) || '1')}`; // 可手動改版本清快取
        const src = url.includes('?') ? `${url}&${bust}` : `${url}?${bust}`;
        try {
          const res = await csrfFetchToRedirect(src, { cache: 'no-store' });
          if (!res.ok) throw new Error(res.statusText);
          el.innerHTML = await res.text();
          el.style.visibility = 'visible';
          el.dispatchEvent(new CustomEvent('partial:loaded', { bubbles: true }));
        } catch (err) {
          el.innerHTML = `<!-- include failed: ${url} -->`;
          el.style.visibility = 'visible';
          console.warn('Include failed:', url, err);
        }
      });

      await Promise.all(tasks);

      // 1) 根據目前 URL 自動加上 active（如果 sidebar 裡的 a[href] 剛好指到當前頁）
      const here = location.pathname.split('/').pop() || 'index.html';
      document.querySelectorAll('aside a.nav-link, aside .nav-treeview a.nav-link').forEach(a => {
        const href = (a.getAttribute('href') || '').split('/').pop();
        if (href && href === here) a.classList.add('active');
      });

      // 2) AdminLTE 如果要初始化（依你專案需要）
      // window.AdminLTE && window.AdminLTE.autoInit?.();

      // 3) 登出（若要清 sessionStorage / localStorage）
      const logout = document.getElementById('logoutLink');
      if (logout) {
        logout.addEventListener('click', (e) => {
          // e.preventDefault(); // 若要攔截導頁再手動跳轉，取消註解
          sessionStorage.removeItem('auth');       // 依專案實際使用的 key
          sessionStorage.removeItem('editingEvent');
          // location.href = logout.getAttribute('href'); // 若攔截，最後導回登入頁
        });
      }
    })();
    </script>
    
    <script>
	  // 開 Modal（點「編輯」）
	  const editModal = new bootstrap.Modal(document.getElementById('editModal'));
	  document.getElementById('btnEdit')?.addEventListener('click', () => editModal.show());
	
	  // 前端驗證：阻擋 HTML5 驗證沒過的提交
	  document.getElementById('accountForm')?.addEventListener('submit', function (e) {
	    if (!this.checkValidity()) {
	      e.preventDefault();
	      e.stopPropagation();
	    }
	    this.classList.add('was-validated');
	  });
	
	  // 成功訊息自動收合（flash: msg）
	  document.addEventListener('DOMContentLoaded', () => {
	    const alertEl = document.querySelector('.alert.alert-success');
	    if (alertEl) setTimeout(() => new bootstrap.Alert(alertEl).close(), 2500);
	  });
	</script>
  </body>
</html>
