<!doctype html>
<html lang="zh-Hant" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <title>展商－重設密碼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css">
  <!-- Icons（用於切換密碼可視） -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <style>
    /* 與登入頁一致 */
    .login-page, .login-page * { box-sizing: border-box; }
    body { background: #fff7f8; }
    .login-page { min-height: 100dvh; display: grid; place-items: center; padding: 24px; }
    .login-card { width: min(760px, 100%); border: 2px solid #2b2b2b; border-radius: 8px; background: #fff; box-shadow: 0 8px 24px rgba(0,0,0,.06); }
    .login-card .card-body { padding: clamp(20px, 4vw, 48px); }
    .login-title { font-weight: 900; font-size: clamp(28px, 4.2vw, 44px); letter-spacing: .02em; margin-bottom: 8px; }
    .login-sub { color: #6c757d; margin-bottom: 24px; }
    .form-label { font-weight: 700; font-size: 1.125rem; }
    .help-text { color: #6c757d; font-size: .95rem; margin-top: .25rem; }
    .form-control, .input-group-text, .btn { border-radius: 14px; }
    .form-control { height: 56px; padding: .75rem 1rem; font-size: 1.05rem; }
    .input-group-text { padding: .5rem .85rem; }
    .btn-primary { background: #e458b2; border-color: #e458b2; }
    .btn-primary:hover { background: #d94aa8; border-color: #d94aa8; }
    .btn-outline-secondary { border-color: #ced4da; }
    .invalid-feedback { margin-top: .4rem; }
  </style>
</head>
<body>
  <main class="login-page">
    <div class="card login-card">
      <div class="card-body">
        <h1 class="login-title">重設密碼</h1>
        <p class="login-sub">請輸入新密碼並確認</p>

        <!-- 全域錯誤（例如 token 過期/無效） -->
        <div th:if="${#fields.hasGlobalErrors()}" class="alert alert-danger" role="alert"
             th:each="e : ${#fields.globalErrors()}" th:text="${e}"></div>

        <form th:action="@{/back-end/exhibitor/reset_password}" th:object="${form}" method="post" novalidate>
          <input type="hidden" th:field="*{token}">
          <input type="hidden" th:field="*{email}">

          <div class="mb-3">
            <label class="form-label">新密碼</label>
            <div class="input-group has-validation">
              <input type="password" class="form-control"
                     th:field="*{password}"
                     minlength="8" maxlength="128"
                     pattern="(?=.*[A-Za-z])(?=.*\d).{8,128}"
                     required th:errorclass="is-invalid" id="pwd">
              <button class="btn btn-outline-secondary" type="button" id="togglePwd" aria-label="切換密碼可視">
                <i class="bi bi-eye"></i>
              </button>
              <div class="invalid-feedback" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
            </div>
            <div class="help-text">至少 8 碼，需含英文字母與數字。</div>
          </div>

          <div class="mb-3">
            <label class="form-label">確認新密碼</label>
            <div class="input-group has-validation">
              <input type="password" class="form-control"
                     th:field="*{confirmPassword}" required th:errorclass="is-invalid" id="pwd2">
              <button class="btn btn-outline-secondary" type="button" id="togglePwd2" aria-label="切換密碼可視">
                <i class="bi bi-eye"></i>
              </button>
              <div class="invalid-feedback" th:if="${#fields.hasErrors('confirmPassword')}" th:errors="*{confirmPassword}"></div>
            </div>
          </div>

          <!-- 比對不一致時，你在後端設計的欄位/物件錯誤，例如 passwordConfirmed -->
          <div class="text-danger mb-3" th:errors="*{passwordConfirmed}"></div>

          <button type="submit" class="btn btn-primary w-100 py-3 fs-5">變更密碼</button>

          <div class="text-end mt-3">
            <a href="/back-end/exhibitor/exhibitor_login"
               class="link-secondary link-underline-opacity-0 link-underline-opacity-75-hover">
              回到登入
            </a>
          </div>
        </form>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // 切換密碼可視（兩個欄位）
    (function () {
      function bindToggle(btnId, iptId){
        const ipt = document.getElementById(iptId);
        const btn = document.getElementById(btnId);
        if (!ipt || !btn) return;
        btn.addEventListener('click', function (e) {
          e.preventDefault();
          const icon = this.querySelector('i');
          const isPwd = ipt.getAttribute('type') === 'password';
          ipt.setAttribute('type', isPwd ? 'text' : 'password');
          icon.classList.toggle('bi-eye', !isPwd);
          icon.classList.toggle('bi-eye-slash', isPwd);
          ipt.focus({ preventScroll: true });
        });
      }
      bindToggle('togglePwd', 'pwd');
      bindToggle('togglePwd2', 'pwd2');
    })();
  </script>
</body>
</html>
