<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <title>Exhibitor | 首頁</title>
    <!-- Fonts & AdminLTE CSS -->
    <!-- <link rel="preload" href="/back-end/css/adminlte.css" as="style" /> -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css" crossorigin="anonymous" media="print" onload="this.media='all'" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/overlaysscrollbars@2.11.0/styles/overlayscrollbars.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"/>
    <link rel="stylesheet" href="/back-end/css/adminlte.css" />
    <style>
      .metric .info-box-icon{width:56px; height:56px; font-size:1.4rem;}
      .search-wrap{display:flex; gap:.5rem; align-items:center}
      .pager{display:flex; gap:.5rem; justify-content:center; align-items:center; padding:10px 0 18px; color:var(--bs-secondary-color)}
      .pager .page{width:32px; height:32px; display:grid; place-items:center; border-radius:6px; border:1px solid transparent; cursor:pointer}
      .pager .page.active{border-color:var(--bs-emphasis-color); color:var(--bs-emphasis-color); font-weight:700}
      .table-ann td .btn{--bs-btn-padding-y:.15rem; --bs-btn-padding-x:.45rem; --bs-btn-font-size:.8rem}
    </style>
  </head>
  <body class="layout-fixed sidebar-expand-lg bg-body-tertiary">
    <div class="app-wrapper">
    <!-- Header（自動注入） -->
    <div data-include="/back-end/header.html"></div>
     

      <!-- Sidebar (使用你提供的結構) -->
       <!-- <div id="sidebar-container"></div> -->
        
      <aside class="app-sidebar bg-body-secondary" data-bs-theme="dark">
        <div class="sidebar-brand">
          <a href="#" class="brand-link">
            <img src="/back-end/img/AdminLTELogo.png" alt="AdminLTE Logo" class="brand-image opacity-75 shadow" />
            <span class="brand-text fw-light">eventra</span>
          </a>
        </div>
        <div class="sidebar-wrapper">
          <nav class="mt-2">
            <ul class="nav sidebar-menu flex-column" data-lte-toggle="treeview" role="navigation" data-accordion="false">
              <li class="nav-item"><a  class="nav-link"><p>展商後台</p></a></li>
              <li class="nav-item menu-open">
                <a href="#" class="nav-link"><i class="nav-icon bi bi-circle-fill"></i><p>展覽管理</p></a>
                <ul class="nav nav-treeview">
                  <li class="nav-item"><a href="/back-end/exhibitor/exhibition_list" class="nav-link"><p>展覽列表</p></a></li>
                
                </ul>
              </li>
              <li class="nav-item menu-open">
                <a href="#" class="nav-link"><i class="nav-icon bi bi-circle-fill"></i><p>銷售管理</p></a>
                <ul class="nav nav-treeview">
                  <li class="nav-item"><a href="/back-end/exhibitor/order_list" class="nav-link"><p>訂單列表</p></a></li>
                  <!-- <li class="nav-item"><a href="#" class="nav-link"><p>銷售列表</p></a></li> -->
                
                </ul>
              </li>
               <li class="nav-item menu-open">
                <a href="#" class="nav-link"><i class="nav-icon bi bi-circle-fill"></i><p>會員中心</p></a>
                <ul class="nav nav-treeview">
                  <li class="nav-item"><a href="/back-end/exhibitor/exhibitor_info" class="nav-link"><p>展商資訊</p></a></li>
                  <li class="nav-item"><a href="/back-end/exhibitor/exhibitor_account_data" class="nav-link"><p>帳戶資料</p></a></li>
                
                </ul>
              </li>
            </ul>
          </nav>
              <!-- 底部：登出連結 -->
          <div class="p-3 border-top">
            <a href="/back-end/exhibitor/exhibitor_login" id="mylogout" class="nav-link text-danger">
              <i class="bi bi-box-arrow-right me-1"></i> 登出
            </a>
          </div>
        </div>
      </aside>
      

      <!-- Main -->
      <main class="app-main">
        <!-- Page header -->
        <div class="app-content-header">
          <div class="container-fluid">
            <div class="row">
              <div class="col-sm-6"><h3 class="mb-0">首頁</h3></div>
              <div class="col-sm-6">
                <ol class="breadcrumb float-sm-end">
                  <!-- <li class="breadcrumb-item"><a href="#">Home</a></li>
                  <li class="breadcrumb-item active" aria-current="page">首頁</li> -->
                </ol>
              </div>
            </div>
          </div>
        </div>

        <!-- Content -->
        <div class="app-content">
          <div class="container-fluid">
            <!-- 指標卡片 -->
            <div class="row">
              <div class="col-12 col-sm-6 col-md-3">
                <a href="../../../../../../../後台展商前端/dist/order_list.html" class="text-decoration-none text-dark">
                  <div class="info-box metric">
                    <span class="info-box-icon text-bg-primary shadow-sm">
                      <i class="bi bi-bag-check-fill"></i>
                    </span>
                    <div class="info-box-content">
                      <span class="info-box-text">新訂單</span>
                      <span class="info-box-number">1</span>
                    </div>
                  </div>
                </a>
              </div>
              <div class="col-12 col-sm-6 col-md-3">
                <div class="info-box metric">
                  <span class="info-box-icon text-bg-success shadow-sm"><i class="bi bi-people-fill"></i></span>
                  <div class="info-box-content">
                    <span class="info-box-text">今日拜訪人數</span>
                    <span class="info-box-number">2</span>
                  </div>
                </div>
              </div>
              <div class="col-12 col-sm-6 col-md-3">
                <div class="info-box metric">
                  <span class="info-box-icon text-bg-warning shadow-sm"><i class="bi bi-cash-coin"></i></span>
                  <div class="info-box-content">
                    <span class="info-box-text">新訂單總額</span>
                    <span class="info-box-number">1,000</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- 公告列表 -->
            <div class="card mt-3">
              <div class="card-header d-flex justify-content-between align-items-center gap-2 flex-wrap">
                <h5 class="card-title mb-0">公告列表</h5>
                <div class="d-flex gap-2 align-items-center">
                  <!-- <a class="btn btn-dark" id="btnCreate">新增公告</a> -->
                  <form class="search-wrap" method="get" th:action="@{/back-end/exhibitor/back_end_homepage}">
				    <div class="input-group input-group-sm">
				      <input class="form-control" type="text" name="q" th:value="${q}" placeholder="搜尋公告…" />
				      <button class="btn btn-outline-secondary" type="submit"><i class="bi bi-search"></i></button>
				    </div>
				  </form>
                </div>
              </div>
              <div class="card-body p-0">
                <div class="table-responsive">
                  <table class="table table-hover m-0 table-ann">
                    <thead class="table-light">
                      <tr>
                        <th style="width:140px">公告日期</th>
                        <th style="width:240px">公告標題</th>
                        <th>公告內容</th>
                        <th style="width:140px" class="text-end">操作</th>
                      </tr>
                    </thead>
                    <tbody id="annTbody">
					  <tr th:if="${#lists.isEmpty(announcements)}">
					    <td colspan="4" class="text-center text-secondary py-4">目前沒有公告</td>
					  </tr>
					
					  <tr th:each="a : ${announcements}">
					    <td th:text="${#dates.format(a.createdAt, 'yyyy/MM/dd')}">2025/00/00</td>
					    <td>
					      <a href="#" class="ann-link"
					         th:text="${a.title}"
					         th:attr="data-title=${a.title},data-date=${#dates.format(a.createdAt,'yyyy/MM/dd')},data-content=${a.content}">
					        公告標題
					      </a>
					    </td>
					    <td>
					      <span class="ann-link text-truncate" style="max-width: 620px; display:inline-block;"
					            th:text="${a.content}"
					            th:attr="data-title=${a.title},data-date=${#dates.format(a.createdAt,'yyyy/MM/dd')},data-content=${a.content}">
					        公告內容
					      </span>
					    </td>
					    <td class="text-end"><!-- 如需操作按鈕可放這 --></td>
					  </tr>
					</tbody>
                  </table>
                </div>
                <div class="pager">
				  <a class="page" th:classappend="${currentPage==0} ? ' disabled'"
				     th:href="@{/back-end/exhibitor/back_end_homepage(page=${currentPage-1},size=${10},q=${q})}">«</a>
				
				  <a class="page"
				     th:each="i : ${#numbers.sequence(0, totalPages-1)}"
				     th:text="${i+1}"
				     th:classappend="${i==currentPage} ? ' active'"
				     th:href="@{/back-end/exhibitor/back_end_homepage(page=${i},size=${10},q=${q})}">
				    1
				  </a>
				
				  <a class="page" th:classappend="${currentPage>=totalPages-1} ? ' disabled'"
				     th:href="@{/back-end/exhibitor/back_end_homepage(page=${currentPage+1},size=${10},q=${q})}">»</a>
				</div>
              </div>
            </div>

          </div>
        </div>
      </main>

      <footer class="app-footer">
        <!-- <div class="float-end d-none d-sm-inline">Anything you want</div>
        <strong>Copyright &copy; 2014-2025 <a href="https://adminlte.io">AdminLTE.io</a>.</strong> All rights reserved. -->
      </footer>
    </div>

    <!-- Modal: 建立/編輯公告 -->
    <div class="modal fade" id="annModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <!-- <h5 class="modal-title" id="annModalTitle">新增公告</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button> -->
          </div>
          <div class="modal-body">
            <form id="annForm" class="row g-3">
              <div class="col-md-4">
                <label class="form-label">公告日期</label>
                <input type="date" class="form-control" id="annDate" required />
              </div>
              <div class="col-md-8">
                <label class="form-label">公告標題</label>
                <input type="text" class="form-control" id="annTitle" placeholder="請輸入公告標題" required />
              </div>
              <div class="col-12">
                <label class="form-label">公告內容</label>
                <textarea class="form-control" id="annContent" rows="6" placeholder="請輸入公告內容" required></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">取消</button>
            <button type="button" class="btn btn-dark" id="btnSave">儲存</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Modal: 公告詳情 -->
    <div class="modal fade" id="annViewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="annViewTitle">公告標題</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
            <p class="text-muted mb-2" id="annViewDate">yyyy/mm/dd</p>
            <div id="annViewContent" style="white-space:pre-wrap;"></div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-dark" data-bs-dismiss="modal">關閉</button>
        </div>
        </div>
    </div>
    </div>


    <!-- Scripts -->
    
    <script src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.11.0/browser/overlayscrollbars.browser.es6.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.min.js"></script>
    <script src="/back-end/js/adminlte.min.js"></script>
    <script src="/front-end/js/g1_10_custom_common_csrf.js"></script>
    <script>
      // Modal controls
      const modalEl = document.getElementById('annModal');
      const modal = new bootstrap.Modal(modalEl);
      const btnCreate = document.getElementById('btnCreate');
      const btnSave = document.getElementById('btnSave');
      const modalTitle = document.getElementById('annModalTitle');
      let editTarget = null;

    //   btnCreate?.addEventListener('click', () => {
    //     editTarget = null;
    //     modalTitle.textContent = '新增公告';
    //     document.getElementById('annForm').reset();
    //     modal.show();
    //   });

      document.getElementById('annTbody')?.addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if(!btn) return;
        const tr = e.target.closest('tr');
        if(btn.dataset.action === 'edit'){
          editTarget = tr;
          modalTitle.textContent = '編輯公告';
          document.getElementById('annDate').value = '2025-07-18';
          document.getElementById('annTitle').value = tr.children[1].textContent.trim();
          document.getElementById('annContent').value = tr.children[2].textContent.trim();
          modal.show();
        } else if(btn.dataset.action === 'delete') {
          if(confirm('確認刪除這筆公告？')) tr.remove();
        }
      });

      // 儲存 (示意)
      btnSave?.addEventListener('click', () => {
        const date = document.getElementById('annDate').value || new Date().toISOString().slice(0,10);
        const title = document.getElementById('annTitle').value.trim();
        const content = document.getElementById('annContent').value.trim();
        if(!title || !content){ alert('請完整填寫表單'); return; }

        if(editTarget){
          editTarget.children[0].textContent = date.replaceAll('-', '/');
          editTarget.children[1].textContent = title;
          editTarget.children[2].textContent = content;
        } else {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${date.replaceAll('-', '/')}</td>
            <td>${title}</td>
            <td class="text-truncate" style="max-width: 620px;">${content}</td>
            <td class="text-end">
              <button class=\"btn btn-outline-secondary btn-sm me-1\" data-action=\"edit\">修改</button>
              <button class=\"btn btn-outline-danger btn-sm\" data-action=\"delete\">刪除</button>
            </td>`;
          document.getElementById('annTbody').prepend(tr);
        }
        modal.hide();
      });

      // 搜尋 (示意 - 僅標題/內容)
      document.getElementById('btnSearch')?.addEventListener('click', () => {
        const q = document.getElementById('searchInput').value.trim();
        const tbody = document.getElementById('annTbody');
        tbody.querySelectorAll('tr').forEach(tr => {
          if(tr.children.length < 4){ return; }
          const text = (tr.children[1].textContent + ' ' + tr.children[2].textContent).toLowerCase();
          tr.style.display = text.includes(q.toLowerCase()) ? '' : 'none';
        });
      });

      // 點擊公告標題/內容 → 開啟詳情 modal
        
    // 點擊公告標題/內容 → 開啟詳情 modal
    (function(){
        const tbody = document.getElementById('annTbody');
        if(!tbody) return;

        // 先抓 modal 內的節點，避免之後每次點擊都 query
        const viewModalEl = document.getElementById('annViewModal');
        const viewTitleEl = document.getElementById('annViewTitle');
        const viewDateEl = document.getElementById('annViewDate');
        const viewContentEl = document.getElementById('annViewContent');

        // 若 modal 沒有放到頁面，直接離開（避免 null 錯誤）
        if(!viewModalEl || !viewTitleEl || !viewDateEl || !viewContentEl){
        return;
        }

        const viewModal = new bootstrap.Modal(viewModalEl);

        tbody.addEventListener('click', (e) => {
        const link = e.target.closest('.ann-link');
        if(!link) return;

        e.preventDefault();

        viewTitleEl.textContent = link.dataset.title || '(未命名公告)';
        viewDateEl.textContent = link.dataset.date || '-';
        viewContentEl.textContent = link.dataset.content || '';

        viewModal.show();
        });
    })();
    
    // 載入header
  //   fetch("header.html")
  //       .then(res => res.text())
  //       .then(data => {
  //       document.getElementById("header-placeholder").innerHTML = data;
  //       });


  //   // 共用載入與高亮
  // fetch("sidebar.html")
  //   .then(res => res.text())
  //   .then(html => {
  //     document.getElementById("sidebar-container").innerHTML = html;

  //     // === 重點：在插入後跑高亮 ===
  //     highlightSidebar();
  //   });

  // function highlightSidebar() {
  //   // 取得目前頁檔名，沒檔名就用 index.html
  //   const current = (location.pathname.split("/").pop() || "index.html").toLowerCase();

  //   // 找出所有側欄連結
  //   const links = document.querySelectorAll("#sidebar-container .sidebar-menu .nav-link[href]");

  //   links.forEach(a => {
  //     const href = (a.getAttribute("href") || "").toLowerCase();
  //     if (!href || href === "#" ) return;

  //     // 只比對檔名（避免不同資料夾問題）
  //     const target = href.split("/").pop();

  //     if (target === current) {
  //       // 高亮目前頁
  //       a.classList.add("active");

  //       // 展開父層（若有樹狀）
  //       a.closest(".nav-item")?.classList.add("menu-open");
  //       a.closest(".nav-treeview")?.closest(".nav-item")?.classList.add("menu-open");

  //       // （可選）在右側加一個小箭頭 icon
  //       // 你也可以改成 bi bi-caret-right-fill 或別的
  //       const marker = document.createElement("i");
  //       marker.className = "bi bi-caret-right-fill ms-auto";
  //       a.appendChild(marker);
  //     }
  //   });
  // }
    // // 載入sidebar
    // fetch("sidebar.html")
    // .then(res => res.text())
    // .then(html => {
    //   document.getElementById("sidebar-container").innerHTML = html;

    //   // 自動判斷當前頁面，給 active 樣式
    //   const links = document.querySelectorAll(".sidebar-menu .nav-link");
    //   const current = window.location.pathname.split("/").pop();
    //   links.forEach(link => {
    //     if (link.getAttribute("href") === current) {
    //       link.classList.add("active");
    //       link.closest(".nav-item")?.classList.add("menu-open"); // 展開父層
    //     }
    //   });
    // });
    </script>
    <script>
      // document.getElementById('logoutLink')?.addEventListener('click', (e) => {
//         e.preventDefault();
        // 清除登入紀錄
//         sessionStorage.removeItem('exhibitorSession');
        // 導回登入頁
//         window.location.href = '/back-end/exhibitor/exhibitor_login';
   // });
    </script>
   <script>
    (async () => {
      // 讓放了 data-include 的容器先隱藏，避免 FOUC
      document.querySelectorAll('[data-include]').forEach(el => el.style.visibility = 'hidden');

      // 載入所有 partial
      const tasks = [...document.querySelectorAll('[data-include]')].map(async (el) => {
        const url = el.getAttribute('data-include');
        const bust = `v=${encodeURIComponent((window.__PARTIALS_VERSION__) || '1')}`; // 可手動改版本清快取
        const src = url.includes('?') ? `${url}&${bust}` : `${url}?${bust}`;
        try {
          const res = await csrfFetchToRedirect(src, { cache: 'no-store' });
          if (!res.ok) throw new Error(res.statusText);
          el.innerHTML = await res.text();
          el.style.visibility = 'visible';
          el.dispatchEvent(new CustomEvent('partial:loaded', { bubbles: true }));
        } catch (err) {
          el.innerHTML = `<!-- include failed: ${url} -->`;
          el.style.visibility = 'visible';
          console.warn('Include failed:', url, err);
        }
      });

      await Promise.all(tasks);

      // 1) 根據目前 URL 自動加上 active（如果 sidebar 裡的 a[href] 剛好指到當前頁）
      const here = location.pathname.split('/').pop() || 'index.html';
      document.querySelectorAll('aside a.nav-link, aside .nav-treeview a.nav-link').forEach(a => {
        const href = (a.getAttribute('href') || '').split('/').pop();
        if (href && href === here) a.classList.add('active');
      });

      // 2) AdminLTE 如果要初始化（依你專案需要）
      // window.AdminLTE && window.AdminLTE.autoInit?.();

      // 3) 登出（若要清 sessionStorage / localStorage）
      const logout = document.getElementById('logoutLink');
      if (logout) {
        logout.addEventListener('click', (e) => {
          // e.preventDefault(); // 若要攔截導頁再手動跳轉，取消註解
          sessionStorage.removeItem('auth');       // 依專案實際使用的 key
          sessionStorage.removeItem('editingEvent');
          // location.href = logout.getAttribute('href'); // 若攔截，最後導回登入頁
        });
      }
    })();
    </script>
    <script>
    (async () => {
      // 讓放了 data-include 的容器先隱藏，避免 FOUC
      document.querySelectorAll('[data-include]').forEach(el => el.style.visibility = 'hidden');

      // 載入所有 partial
      const tasks = [...document.querySelectorAll('[data-include]')].map(async (el) => {
        const url = el.getAttribute('data-include');
        const bust = `v=${encodeURIComponent((window.__PARTIALS_VERSION__) || '1')}`; // 可手動改版本清快取
        const src = url.includes('?') ? `${url}&${bust}` : `${url}?${bust}`;
        try {
          const res = await csrfFetchToRedirect(src, { cache: 'no-store' });
          if (!res.ok) throw new Error(res.statusText);
          el.innerHTML = await res.text();
          el.style.visibility = 'visible';
          el.dispatchEvent(new CustomEvent('partial:loaded', { bubbles: true }));
        } catch (err) {
          el.innerHTML = `<!-- include failed: ${url} -->`;
          el.style.visibility = 'visible';
          console.warn('Include failed:', url, err);
        }
      });

      await Promise.all(tasks);

      // 1) 根據目前 URL 自動加上 active（如果 sidebar 裡的 a[href] 剛好指到當前頁）
      const here = location.pathname.split('/').pop() || 'index.html';
      document.querySelectorAll('aside a.nav-link, aside .nav-treeview a.nav-link').forEach(a => {
        const href = (a.getAttribute('href') || '').split('/').pop();
        if (href && href === here) a.classList.add('active');
      });

      // 2) AdminLTE 如果要初始化（依你專案需要）
      // window.AdminLTE && window.AdminLTE.autoInit?.();

      // 3) 登出（若要清 sessionStorage / localStorage）
      const logout = document.getElementById('logoutLink');
      if (logout) {
        logout.addEventListener('click', (e) => {
          e.preventDefault(); // 若要攔截導頁再手動跳轉，取消註解
//           sessionStorage.removeItem('auth');       // 依專案實際使用的 key
//           sessionStorage.removeItem('editingEvent');
          // location.href = logout.getAttribute('href'); // 若攔截，最後導回登入頁
          
          // 可以不用 csrfFetch (有另外放權限)
          fetch("/api/auth/logout/exhibitor", { 
        	method: "POST",
          })
          .then((res) => {
        	  if(res.status === 204)
        		  location.href = "/back-end/exhibitor/exhibitor_login";
        	  if(!res.ok) throw new Error("Not 2XX");
          })
          .catch(error => console.log(error))
          
        });
      }
    })();
    </script>



  </body>
</html>
