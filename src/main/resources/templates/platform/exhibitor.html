<!doctype html>
<html lang="zh-Hant" xmlns:th="http://www.thymeleaf.org">
<!--begin::Head-->

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Eventra 管理者平台 — 廠商申請列表</title>
<!--begin::Accessibility Meta Tags-->
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<meta name="color-scheme" content="light dark" />
<meta name="theme-color" content="#007bff"
	media="(prefers-color-scheme: light)" />
<meta name="theme-color" content="#1a1a1a"
	media="(prefers-color-scheme: dark)" />
<!--end::Accessibility Meta Tags-->
<!--begin::Accessibility Features-->
<!-- Skip links will be dynamically added by accessibility.js -->
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css"
	crossorigin="anonymous" media="print" onload="this.media='all'" />
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.11.0/styles/overlayscrollbars.min.css"
	crossorigin="anonymous" />
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
	crossorigin="anonymous" />
<link rel="stylesheet" href="./css/adminlte.css" />
<style>

body {
	font-family: "Source Sans 3", "Noto Sans TC", "Microsoft JhengHei",
		system-ui, -apple-system, "Segoe UI", Roboto, sans-serif
}

.logo-circle {
	width: 96px;
	height: 96px;
	border-radius: 50%;
	display: flex;
	align-items: center;
	justify-content: center;
	background: rgba(0, 0, 0, .06)
}

.panel {
	background: #fff;
	border-radius: 1rem;
	border: 1px solid #e5e7eb;
	overflow: hidden
}

.panel-title {
	font-weight: 700;
	padding: 1rem 1.25rem
}

.table thead th {
	background: #54595f;
	color: #fff;
	border-color: #54595f;
	font-weight: 700
}

.table tbody tr:nth-child(even) {
	background: #f5f5f5
}

.chip {
	display: inline-block;
	padding: .2rem .6rem;
	border-radius: 999px;
	font-size: .875rem;
	line-height: 1
}

.chip.approved {
	background: #28A745;
	border: 1px solid #cbd5e1;
	color: #fff;
}

.chip.pending {
	background: #fff;
	border: 1px solid #000;
	color: #111827
}

.chip.failed {
	background: #e11d48;
	color: #fff;
}

.skeleton {
	height: 44px;
	background: #e5e5e5;
	border-radius: 6px
}

.pager-wrap {
	padding: 1rem 0
}

button:disabled {
  background-color: gray !important;
  cursor: not-allowed;
  pointer-events: none;
  opacity: 0.6; /* 可選：讓它更像禁用狀態 */
}

</style>
</head>
<body
	class="layout-fixed sidebar-expand-lg sidebar-open bg-body-tertiary">
	<div class="app-wrapper">

		<!-- Header -->
		<nav class="app-header navbar navbar-expand bg-body-tertiary"
			data-bs-theme="dark">
			<div class="container-fluid">
				<ul class="navbar-nav">
					<li class="nav-item"><a class="nav-link"
						data-lte-toggle="sidebar" href="#" role="button" aria-label="切換側欄"><i
							class="bi bi-list"></i></a></li>
				</ul>
				<ul class="navbar-nav ms-auto">
					<li class="user-footer"><a href="/dist/examples/login.html"
						class="btn btn-default btn-flat float-end">Sign out</a></li>
				</ul>
			</div>
		</nav>

		<!-- Sidebar -->
		<aside class="app-sidebar bg-body-tertiary" data-bs-theme="dark">
			<div class="sidebar-brand text-center py-4">
				<a href="#" class="brand-link d-flex flex-column align-items-center">
					<div class="logo-circle mb-2">Logo</div> <span
					class="brand-text fw-light">平台管理系統</span>
				</a>
			</div>
			<div class="sidebar-wrapper">
				<nav class="mt-2">
					<ul class="nav sidebar-menu flex-column" data-lte-toggle="treeview"
						role="navigation" aria-label="Main navigation"
						data-accordion="false">
						<li class="nav-item"><a href="#" class="nav-link"><i
								class="nav-icon bi bi-people-fill"></i>
								<p>
									用戶管理<i class="nav-arrow bi bi-chevron-right"></i>
								</p></a></li>
						<li class="nav-item"><a href="#" class="nav-link"><i
								class="nav-icon bi bi-chat-left-text-fill"></i>
								<p>
									留言管理<i class="nav-arrow bi bi-chevron-right"></i>
								</p></a></li>
						<li class="nav-item menu-open"><a href="#"
							class="nav-link active"><i
								class="nav-icon bi bi-pencil-square"></i>
								<p>
									申請管理<i class="nav-arrow bi bi-chevron-right"></i>
								</p></a>
							<ul class="nav nav-treeview">
								<li class="nav-item"><a href="#" class="nav-link active"
									style="padding-left: 56px;"><p>廠商申請</p></a></li>
								<li class="nav-item"><a href="#" class="nav-link"
									style="padding-left: 56px;"><p>活動申請</p></a></li>
							</ul></li>
						<li class="nav-item"><a href="#" class="nav-link"><i
								class="nav-icon bi bi-circle"></i>
								<p>訂單管理</p></a></li>
						<li class="nav-item"><a href="#" class="nav-link"><i
								class="nav-icon bi bi-circle"></i>
								<p>報表管理</p></a></li>
						<li class="nav-item mt-4"><a href="#" class="nav-link"><i
								class="nav-icon bi bi-box-arrow-right"></i>
								<p>登出</p></a></li>
					</ul>
				</nav>
			</div>
		</aside>

		<!-- Main -->
		<main class="app-main">
			<div class="app-content-header">
				<div class="container-fluid">
					<h1 class="mb-3" style="font-weight: 700; font-size: 32px;">展商註冊申請管理</h1>
				</div>
			</div>

			<div class="app-content">
				<div class="container-fluid">
					<div class="panel">
						<div class="panel-title bg-body-secondary">展商註冊申請列表</div>
						<div class="table-responsive">
							<table class="table align-middle mb-0">
								<thead>
									<tr>
										<th style="width: 15%;">審核狀態</th>
										<th style="width: 12%;">統一編號</th>
										<th style="width: 25%;">公司名稱</th>
										<th style="width: 23%;">信箱</th>
										<th style="width: 15%;">聯絡電話</th>
										<th style="width: 10%;">操作</th>
									</tr>
								</thead>
								<tbody>
									<!-- 用 th:each 迭代 exhibitorList -->
									<tr th:each="ex : ${exhibitorList}">
										<!-- 審核狀態 chip -->
										<td><span
											th:class="'chip ' + 
            (${ex.exhibitorReviewStatus} == '已核准' ? 'approved' : 
             (${ex.exhibitorReviewStatus} == '待核准' ? 'pending' : 'failed'))"
											th:text="${ex.exhibitorReviewStatus}"> </span></td>

										<!-- 統一編號 -->
										<td th:text="${ex.businessIdNumber}"></td>

										<!-- 公司名稱 -->
										<td th:text="${ex.companyName}"></td>

										<!-- 信箱 -->
										<td th:text="${ex.email}"></td>

										<!-- 聯絡電話 -->
										<td th:text="${ex.contactPhone}"></td>

										<!-- 操作欄位（可以放按鈕或表單操作） -->
										<td>
											<button class="btn btn-sm btn-primary"
												th:value="${ex.exhibitorId}"
												th:disabled="${ex.exhibitorReviewStatus != '待核准'}"
												onclick="to_exhibitor_edit(this)" style="margin-right: 4px">審核</button>
										</td>
									</tr>

									<!-- 骨架列：如果沒有資料就顯示 skeleton -->
									<tr th:if="${#lists.isEmpty(exhibitorList)}">
										<td colspan="6">
											<div class="skeleton w-100">目前已無待審核展商</div>
										</td>
									</tr>
								</tbody>
							</table>

						</div>

						<!-- 分頁 -->
						<div class="d-flex justify-content-center pager-wrap"
							aria-label="列表分頁">
							<ul class="pagination pagination-sm mb-0">

								<!-- « 上一頁 -->
								<li th:classappend="${currentPage == 1} ? 'disabled'"
									class="page-item"><a class="page-link"
									th:href="@{/platform/exhibitor(page=${currentPage - 1})}">«</a>
								</li>

								<!-- 頁碼 -->
								<li
									th:each="i : ${#numbers.sequence(
          (currentPage - 2 > 0) ? currentPage - 2 : 1,
          (currentPage + 2 < totalPages) ? currentPage + 2 : totalPages
        )}"
									th:classappend="${i == currentPage} ? 'active'"
									class="page-item"><a class="page-link"
									th:href="@{/platform/exhibitor(page=${i})}" th:text="${i}"></a>
								</li>

								<!-- » 下一頁 -->
								<li th:classappend="${currentPage == totalPages} ? 'disabled'"
									class="page-item"><a class="page-link"
									th:href="@{/platform/exhibitor(page=${currentPage + 1})}">»</a>
								</li>

							</ul>
						</div>
					</div>
				</div>
			</div>
		</main>

		<footer class="app-footer">
			<strong>Copyright &copy; 2025&nbsp;&nbsp;<span
				class="text-decoration-none">Eventra Inc.</span></strong> ｜ Tibame TJA102 G1
			專題製作
		</footer>
	</div>

	<script
		src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.11.0/browser/overlayscrollbars.browser.es6.min.js"
		crossorigin="anonymous"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
		crossorigin="anonymous"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.min.js"
		crossorigin="anonymous"></script>
	<script src="./js/adminlte.js"></script>
	<script>
  document.addEventListener('DOMContentLoaded', () => {
    const sw = document.querySelector('.sidebar-wrapper');
    if (sw && OverlayScrollbarsGlobal?.OverlayScrollbars) {
      OverlayScrollbarsGlobal.OverlayScrollbars(sw, { scrollbars:{ autoHide:'leave' }});
    }
  });
</script>
	<script>

	// 下面塞 xsrf 入 form input hidden 時候會用一次
	function getCookie(name) {
		const value = `; ${document.cookie}`; // "; XSRF-TOKEN=abc123; theme=dark; sessionId=xyz789"
		const parts = value.split(`; ${name}=`); // ["; ", "abc123; theme=dark; sessionId=xyz789"]
		if (parts.length === 2) return parts.pop().split(";").shift(); // 2代表有該 cookie(1則為沒有） -> 拿後面陣列 -> 以;分隔 -> 拿第一個值
		return null;
	}
	
	const to_exhibitor_edit = function(btn) {
		// 1. form
		const form_el = document.createElement("form");
		form_el.method = "POST";
		form_el.action = "/platform/exhibitor_detail";
		
		// 2. input -> exhibitorId
		const input_el = document.createElement("input");
		input_el.name = "exhibitorId";
		input_el.value = btn.value;
		form_el.appendChild(input_el);
		
		// 3. input -> xsrf
		const hidden = document.createElement("input");
		hidden.type = "hidden";
		hidden.name = "_csrf";
		hidden.value = getCookie("XSRF-TOKEN");
		form_el.appendChild(hidden);

		// 4. 塞 form 進入 body 後 .submit()
		const body_el = document.querySelector("body");
		body_el.appendChild(form_el);
		form_el.submit();
	}

</script>
</body>
</html>
